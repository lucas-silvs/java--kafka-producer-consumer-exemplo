apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: kafka-keda-consumer-trigger
  namespace: consumer
spec:
  minReplicaCount: 2 # Defina aqui o número mínimo de réplicas desejado
  maxReplicaCount: 6 # Defina aqui o número máximo de réplicas desejado

  scaleTargetRef:
    name: consumer-deployment
  pollingInterval: 3
  triggers:
    #  Configuração para configuração de trigger utilizando lag de consumer Kafka
    - type: kafka
      metadata:
        bootstrapServers: broker.kafka.svc.cluster.local:9093
        consumerGroup: consumer-teste # Consumer group que será monitorado
        topic: topico-teste-avro # Tópico que será monitorado
        lagThreshold: "3" # Limite de lag para iniciar a escala
        offsetResetPolicy: latest # Política de reset de offset
        sasl: plaintext # Configuração de autenticação

      # Configuração para utilizar objeto de autenticação do tipo ClusterTriggerAuthentication (que contem valor do AWS Secret Manager)
      # Esse artefato disponibiliza os campos "username" e "password" para autenticação
      authenticationRef:
        name: kafka-trigger-auth-aws-secret-manager
        kind: ClusterTriggerAuthentication

    #  Configuração para configuração de trigger utilizando porcentagem de utilização do CPU
    - type: cpu
      metricType: Utilization
      metadata:
        value: "60" #valor é calculado em porcentagem
